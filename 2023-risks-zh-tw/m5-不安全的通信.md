---
layout: col-sidebar
title: "M5: 不安全的通信"
---

# 威脅主體

**應用層面 特定**

大多數現代行動應用程式與一個或多個遠端伺服器交換數據。當進行數據傳輸時，通常會經過行動裝置的載體網路和網際網路，如果以純文本形式或使用已淘汰的加密協議傳輸，威脅主體可以攔截和修改數據。威脅主體可能有不同的動機，例如竊取敏感信息、進行間諜活動、身份盜竊等。以下是存在的威脅主體：
- 與您共用本地網路的攻擊者（已經被入侵或監控的Wi-Fi）
- 惡意的載體或網路設備（路由器、基站、代理等）；
- 行動裝置上的惡意軟體。

# 攻擊媒介	

**利用難度 簡單**

雖然現代應用程式確實依賴於諸如SSL/TLS等加密協議，但它們有時在實施中可能存在缺陷，例如：

* 使用已淘汰的協議和/或不良的配置設置；
* 接受不良的SSL證明（自簽名、撤銷、過期、錯誤的主機等）;
* 不一致性（僅在選定的工作流程（例如身份驗證）上使用SSL/TLS）。

# 安全層面的強度

**普及性 常見** 

**偵測性 平均**

雖然現代行動應用程式的目標是保護網絡流量，但它們的實行往往存在不一致性。這些不一致性可能導致漏洞，使數據和會話ID被攔截。一個應用程式使用了傳輸安全協議並不意味著它的實行是正確的。要識別基本的缺陷，您可以觀察手機上的網絡流量。然而，要檢測更微妙的缺陷，需要更仔細地查看應用程式的設計和配置。

# 技術性影響

**影響程度 嚴重**

這種缺陷可能會讓用戶的數據曝露，可能導致帳戶被接管、用戶冒充、個人身份信息（PII）數據泄露等問題。舉例來說，攻擊者可能截取用戶憑證、會話、雙因素認證令牌，這可能為更複雜的攻擊打開門戶。

# 業務影響
	
**影響程度 中等** 

在最低程度上，通過通信渠道截取敏感數據將導致違反隱私。

侵犯用戶保密性(confidentiality)將導致:

* 身分竊盜
* 詐騙
* 名譽損害


# 我是否容易受到「不安全的通信」的攻擊？

這個風險涵蓋了所有不安全地從A點到B點獲取數據的方式。它包括行動裝置間的通信、應用程式到伺服器的通信，或行動裝置與其他東西間的通信。此風險包括行動裝置可能使用的所有通信技術：TCP/IP、WiFi、藍牙/藍牙低功耗、NFC、音頻、紅外線、GSM、3G、短信等。

所有TLS通信問題都源於此。所有NFC、藍牙和WiFi問題都源於此。

明顯的特徵包括將某種敏感數據封裝起來並將其傳輸到裝置內或裝置外。一些敏感數據的例子包括加密密鑰、密碼、私人用戶信息、帳戶詳細信息、會話令牌、文檔、詮釋資料和二進制數據。敏感數據可以從伺服器傳輸到裝置，也可以從應用程式傳輸到伺服器，或者可能在裝置和其他本地裝置之間進行傳輸（例如，與NFC終端或NFC卡通信）。這種風險的明確特徵是存在兩個裝置並在它們之間傳遞一些數據。

如果數據存儲在裝置本身，那就是 #非安全數據。如果會話詳細信息是安全傳輸的（例如，通過強大的TLS連接），但會話標識本身有問題（也許是可預測的、低混亂的等等），那麼這就是一個 #非安全認證 的問題，而不是通信問題。

不安全通信的通常風險涉及數據完整性、數據保密性和來源完整性。如果數據在傳輸過程中可以被更改，而無法檢測到這種更改（例如，通過中間人攻擊），那麼這就是這種風險的一個好例子。如果可以通過監聽通信時發生的事情（即竊聽）或者通過錄製對話並在之後進行攻擊（離線攻擊）來暴露、學習或推導機密數據，那麼這也是不安全通信的問題。未能正確設置和驗證TLS連接（例如，憑證檢查、不良的加密算法、其他TLS配置問題）都屬於不安全通信的範疇。

# 如何避免「不安全的通信」？

**一般情況的最佳做法**

* 假設網絡層不安全且容易被竊聽。
* 對行動應用程序用來將數據傳輸到後端API或Web服務的傳輸通道應用SSL/TLS。
* 在應用程序通過瀏覽器/Webkit運行例行程序時，考慮外部實體（如第三方分析公司、社交網絡等），使用它們的SSL版本。避免混合SSL會話，因為這可能會暴露用戶的會話ID。
* 使用強大的業界標準密碼套件，並使用適當的密鑰長度。
* 使用由可信的憑證管理中心(CA)提供者簽名的認證。
* 永遠不要允許不良的認證（自簽名、過期、不受信任的root、撤銷、錯誤的主機...）。
* 考慮固定的認證。
* 始終要求SSL鏈驗證。
* 只有在使用可信的密鑰鏈中的認證，來核實端點服務器的身份之後，才建立安全連接。
* 如果行動應用程序檢測到無效認證，通過UI向用戶發出警告。
* 不要通過替代通道（例如SMS、MMS或通知）發送敏感數據。
* 如果可能，在將敏感數據提供給SSL通道之前，對其應用單獨的加密層。如果將來在SSL實施中發現漏洞，加密數據將提供對保密性侵犯的第二防禦。
* 在開發周期中，避免覆蓋SSL驗證方法以允許不受信任的認證，而是嘗試使用自簽名認證或本地開發憑證管理中心(CA)。
* 在安全評估期間，建議分析應用程式的流量，查看是否有任何流量通過明文渠道。

**適用於IOS的最佳做法**


在iOS的最新版本中，默認的類別非常好地處理了SSL密碼強度協商。問題出現在開發人員臨時添加代程式碼以規避這些默認值以應對開發障礙的情況。除了上述的一般作法之外:

* 確保認證有效並在執行失敗時關閉
* 在使用`CFNetwork`時，考慮使用安全傳輸API來指定可信任的客戶端認證。幾乎在所有情況下，應使用更高標準密碼強度的 `NSStreamSocketSecurityLevelTLSv1`。
* 在開發後，確保所有`NSURL`調用（或`NSURL`的包裝器）不允許自簽名或無效認證，例如`NSURL`類方法`setAllowsAnyHTTPSCertificate`。
* 考慮使用固定認證，具體操作如下：輸出您的認證，將其包含在應用程式包中，並將其錨定到您的信任對象。現在使用NSURL方法 `connection:willSendRequestForAuthenticationChallenge`: 會接受您的憑證。

**適用於Android的最佳做法**

* 在開發周期之後，刪除所有允許應用程式接受所有認證的程式碼，例如org.apache.http.conn.ssl.AllowAllHostnameVerifier或SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER。這等同於信任所有認證。
* 如果使用擴展了SSLSocketFactory的類別，請確保 checkServerTrusted 方法被正確實行，以便正確檢查伺服器認證。
* 避免覆寫 `onReceivedSslError` 以允許無效的SSL憑證。

# 攻擊情境舉例


在檢查行動應用程式通信安全性時，侵入測試人員通常會發現一些常見的情境:

**缺乏認證檢查**

行動應用程式和端點成功連接並執行TLS握手以建立安全通道。然而，行動應用程式未檢查伺服器提供的認證，並且無條件接受伺服器提供的任何認證。這破壞了行動應用程式與端點之間的互相身份驗證能力。該行動應用程式容易受到TLS代理的中間人攻擊。

**脆弱的握手(handshake)協商**

行動應用程式和端點成功連接，並協商了一個密碼套件作為連接握手的一部分。客戶端成功與伺服器協商使用一個脆弱的密碼套件，導致脆弱加密，易受對手的解密。這危及了行動應用程式和端點之間通道的保密性。

**隱私信息洩露**

行動應用程式將個人身份信息透過非安全通道傳送到端點，而不是使用SSL/TLS。這危及了移動應用程式和端點之間任何與隱私相關數據的保密性。

**憑證信息洩露**

行動應用程式將用戶憑證透過非安全通道傳送到端點，而不是使用SSL/TLS。這允許對手以明文形式攔截這些憑證。

**雙因子身分驗證規避**

行動應用程式透過非安全通道從端點接收會話標識符，而不是使用SSL/TLS。這允許攻擊者使用攔截的會話標識符規避雙因素身份驗證。


# 參考資料

- OWASP
  - [OWASP](https://www.owasp.org/)
- External
  - [External References](http://cwe.mitre.org/)
