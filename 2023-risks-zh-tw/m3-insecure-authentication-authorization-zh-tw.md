---

layout: col-sidebar
title: "M3: 不安全的身份驗證/授權"
---

# 威脅主體

**應用層面 特定**

利用身份驗證和授權漏洞的威脅主體通常會通過使用現有或自行創建的工具進行自動化攻擊。

# 攻擊媒介

**利用難度 簡單**

一旦攻擊者瞭解身份驗證或授權架構中的漏洞，他們可以以兩種方式利用這些弱點。他們可能通過直接向手機應用程式的後端伺服器提交服務請求來仿冒或繞過身份驗證，避免與手機應用程式進行直接交互，或者在成功通過身份驗證控制後以合法用戶的身份登錄應用程式，然後強制瀏覽到一個有漏洞的端點以執行管理層級的功能。這兩種利用方法通常是通過裝置中的手機惡意軟體或攻擊者擁有的僵屍網絡完成的。

# 安全層面的強度

**普及性 常見**

**偵測性 平均**

為了測試手機應用程式中不良的授權和身份驗證架構，測試人員可以採用多種策略。在授權方面，測試人員可以對手機應用程式進行二進制攻擊，嘗試執行僅在具有較高權限的情況下才能執行的特權功能，特別是在手機應用程式處於「離線」模式時。測試人員還應該嘗試使用相應的 POST/GET 請求，以低權限會話令牌(session token)執行任何特權功能，將這些功能發送到後端伺服器。

不良或有缺失的授權架構可能允許攻擊者以已驗證但較低權限的手機應用程式用戶的身份執行他們不應被授予的功能。當授權決策是在手機裝置內執行而不是通過遠程伺服器進行時，特權升級攻擊的風險會增加，這種情況通常是由於手機要求離線可用性而引起的。

在不良的身份驗證架構方面，測試人員可以在手機應用程式處於「離線」模式時對其進行二進制攻擊，試圖繞過離線身份驗證，然後執行需要離線身份驗證的功能。測試人員還應該嘗試通過從手機應用程式功能的任何 POST/GET 請求中刪除任何會話令牌，以匿名方式執行任何後端伺服器功能。

不良或有缺失的身份驗證架構，會允許攻擊者匿名地在手機應用程式內部，或手機應用程式使用的後端伺服器中執行功能。由於手機裝置的輸入形式，這些在手機應用程式身份驗證中的弱點相當普遍，這種輸入形式通常鼓勵使用短密碼或4位數的PIN碼。

手機應用程式要面對獨特的身份驗證要求，這些要求可能與傳統的網絡身份驗證架構有所不同，主要是因為它們不同的可用性要求。與傳統的網絡應用程式不同，傳統網絡應用程式預期用戶應該在線並實時與後端伺服器進行身份驗證。因為移動網路連線的不穩定性或不可預測性，手機應用程式可能需要滿足不間斷運行的要求，這要求離線身份驗證。這一要求可能會在實施行動裝置身份驗證時，顯著影響開發人員必須考慮的因素。

# 技術性影響

**影響程度 嚴重**

不良的系統授權和身份驗證的技術性影響可能是廣泛的，嚴重的，而且類似的。這在很大程度上取決於超出權限的功能的類型。舉例來說，對於不良的授權，對遠程或本地管理功能的超出權限的程式執行可能會摧毀系統或讓攻擊者能夠訪問敏感信息。

不良身份驗證的所造成的後果，會在解決方案無法識別執行請求的用戶時發生。因為無法建立用戶的身份，這可能會立即導致無法記錄或監聽用戶活動。這種身份驗證的缺失導致難以檢測攻擊的來源，難以了解潛在的漏洞的性質，或制定防止未來攻擊的策略。

此外，身份驗證錯誤還可能暴露底層的授權錯誤。當身份驗證控制失敗時，程式無法驗證用戶的身份，而這與用戶的角色和其相關權限密切相關。如果攻擊者可以匿名執行敏感功能，這表明底層程式碼未驗證發出該請求的用戶的權限。因此，程式碼的匿名執行凸顯了身份驗證和授權控制的錯誤。

# 業務影響

**影響程度 嚴重**

不良的身份驗證和授權對業務的影響至少包括以下方面：

* 名聲損害
* 資訊竊盜
* 詐欺
* 未經授權的訪問資料


# 我是否容易受到「不安全的身份驗證/授權」的威脅？

在評估行動裝置應用程式的安全性時，深入理解身份驗證和授權之間的區別至關重要。身份驗證確定個體的身份，而授權驗證已確認的個體是否具有執行特定操作所需的權限。這兩個方面密切相關，因為授權檢查應該立即在身份驗證請求之後執行。

當組織在執行來自行動裝置的請求的 API 之前，在未對個體進行身份驗證的情況下，會發生不安全的授權。因為在沒有建立調用者身份的情況下，幾乎不可能對傳入的請求進行授權檢查。

以下是一些不安全授權的明顯指標：

* **存在越權漏洞 (IDOR)** - IDOR 越權漏洞意味著程式碼未進行適當的授權檢查。
* **隱藏端點** - 開發人員在後端隱藏功能上忽略了授權檢查，他們假設了只有具有適當角色的用戶才能訪問隱藏功能。
* **用戶角色或權限傳輸** - 如果行動應用程式在請求中傳輸用戶的角色或權限到後端系統，這表示存在不安全的授權。

同樣，行動應用程式也會顯示各種不安全身份驗證的跡象：

* **匿名後端 API 的執行** - 具有執行後端 API 服務請求的能力，且無需提供存取令牌的應用程式，意味著不安全的身份驗證。
* **本地儲存密碼或共享密鑰** - 如果應用程式在裝置上本地儲存任何密碼或共享密鑰，這是不安全身份驗證的跡象。
* **弱密碼制度** -  使用簡化的密碼輸入流程可能意味著不安全的身份驗證。
* **使用 FaceID 和 TouchID 等功能** - 使用 FaceID 或 TouchID 等功能可能表示不安全的身份驗證。

# 如何預防「不安全的身份驗證和授權」？

為了防止不安全的身份驗證和授權，避免弱點模型並強化安全措施是非常重要的。

**避免弱點模型(weak pattern)**

避免使用不安全的行動應用程式認證模型:

* 如果您將網站應用程式移植到行動應用程式，請確保行動應用程式的身份驗證需求與網站應用程式的元件相符。在身份驗證時，不應該比網頁瀏覽器使用更少的驗證要素。
* 本地使用者身份驗證可能導致客戶端規避認證的漏洞。如果應用程式在本地儲存數據，駭客可能通過運行時操作或二進制修改在越獄的設備上規避身份驗證程序。如果離線身份驗證是一個迫切的業務需求，請參考有關防止針對行動應用程式的二進制攻擊的額外指南。
* 在可能的情況下，所有身份驗證請求應在伺服器端進行。在成功驗證後，再將應用程式數據將加載到行動裝置上，確保僅在成功驗證後才能使用應用程式數據。
* 如果需要客戶端數據存儲，應使用從用戶登錄憑證中衍生的加密金鑰對數據進行加密。然而，仍存在通過二進制攻擊解密數據的額外風險。
* “記住我”功能永遠不應該在裝置上儲存使用者的密碼。
* 行動應用程式在理想情況下應使用一個裝置特定的身份驗證令牌，該令牌可以由用戶在應用程式中撤銷，以減輕由於設備丟失或被盜而導致的未經授權訪問風險。
* 避免使用可被偽造的數值進行用戶身份驗證，包括裝置辨識碼或地理位置。
* 行動應用程式中的持久身份驗證應該作為選項加以實施，而不是默認啟用。
* 在可能的情況下，應禁止用戶提供4位數的PIN碼作為身份驗證密碼。

**強化身分驗證**

* 開發人員應該假設所有客戶端的授權和身份驗證控制都可能被惡意使用者規避。對這些控制進行伺服器端強化至關重要。
* 由於離線使用的需求，行動應用程式可能需要執行本地身份驗證或授權檢查。在這種情況下，開發人員應該實施本地完整性檢查，以檢測任何未經授權的程式碼更改。請參考有關檢測和應對二進制攻擊的額外指南。
* 使用 FaceID 和 TouchID 來解鎖生物識別的鎖定機密，並安全地保護敏感的身份驗證資料，如會話令牌(session token)。

**避免不安全的授權**

避免不安全的授權:

* 後端系統應獨立驗證已被驗證的使用者角色和權限。不要依賴來自行動裝置的任何角色或權限信息。
* 假設所有客戶端授權都可能被規避，因此在可能的情況下，加強伺服器端授權控制。
* 如果在行動應用程式的程式碼，有需要離線授權檢查，開發人員應執行本地完整性檢查(integrity check)，以檢測未經授權的程式碼更改。

# 攻擊情境舉例

以下情境展示了行動應用程式中不安全的身份驗證或授權控制:

**情境1:** 隱藏的服務請求：開發人員假設只有驗證的使用者才能生成程式提交給後端進行處理的服務請求。在處理請求的過程中，伺服器程式碼未驗證傳入的請求是否與已知使用者相關聯。因此，攻擊者能夠提交服務請求到後端服務，匿名執行會影響到合法使用者的功能。

**情境2:** 介面依賴：開發人員假設只有經授權的使用者才能看到其應用程式上的特定功能。因此，他們期望只有合法經授權的使用者才能從其行動裝置發出對服務的請求。處理請求的後端程式碼未驗證與請求相關聯的身份是否有權執行服務。因此，攻擊者能夠使用相當低權限的使用者帳戶執行遠程管理功能。

**情境3:** 可用性要求：由於可用性要求，行動應用程式允許使用4位數字的密碼。伺服器程式碼正確地儲存密碼的雜湊版本。然而，由於密碼的長度極短，攻擊者將能夠透過彩虹表迅速推斷出原始密碼。如果伺服器上的密碼文件（或數據存儲）受到威脅，攻擊者將能夠快速推斷出使用者的密碼。

**情境4:** 不安全的直接物件參照：使用者對後端 REST API 發送 API 端點請求，包括演員 ID 和 OAuth bearer 令牌。使用者將其演員 ID 包含在傳入 URL 的一部分，並將訪問令牌作為請求的標準標頭包含在其中。後端驗證了 bearer 令牌的存在，但未驗證與 bearer 令牌相關聯的演員 ID。因此，使用者可以調整演員 ID 並在 REST API 請求的一部分中獲取其他使用者的帳戶信息。

**情境5:** 傳輸 LDAP 角色：使用者對後端 REST API 發送 API 端點請求，包括標準的 oAuth bearer 令牌以及一個標頭，其中包含用戶屬於的 LDAP 群組列表。後端請求驗證了 bearer 令牌，然後檢查傳入的 LDAP 群組以確保正確的群組成員資格，然後繼續進行敏感功能。然而，後端系統未對 LDAP 群組成員身分進行獨立驗證，而是依賴於來自用戶的傳入 LDAP 信息。使用者可以調整傳入的標頭，報告為任何 LDAP 群組的成員，並執行管理功能。

# 參考資料

- OWASP
    - [OWASP](https://www.owasp.org/index.php/OWASP_Top_Ten)
- External
    - [External References](http://cwe.mitre.org/)
