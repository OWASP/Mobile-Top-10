---

layout: col-sidebar
title: "M5: 不佳的身份驗證與授權"
---

# 威脅主體

**應用層面 特定**

利用身份驗證和授權漏洞的威脅主體通常會通過使用現有或自行創建的工具進行自動化攻擊。

# 攻擊媒介	

**利用難度 簡單**

一旦攻擊者了解身份驗證方案存在弱點，他們可能通過向行動應用程式的後端伺服器提交服務請求，以仿冒或規避身份驗證，而無需直接與行動應用程式互動。這個提交過程通常是通過裝置內的行動惡意軟體或攻擊者擁有的僵屍網絡來執行的。

# 安全層面的強度

**普及性 常見** <br />
**偵測性 簡單**

不佳或有所缺失的身份驗證架構使得攻擊者可以匿名執行行動應用程式或行動應用程式的後端伺服器中的功能。由於行動裝置的輸入形式，行動應用程式的身份驗證通常較弱，也容易出現缺失。該輸入形式強烈鼓勵使用基於4位數PIN碼的簡短密碼。

由於可用性要求的不同，行動應用程式的身份驗證要求可能與傳統的Web身份驗證架構有很大區別。

在傳統的Web應用程式中，預期用戶會在線並實時與後端伺服器進行身份驗證。在會話期間，合理預期他們將持續訪問網際網路。

在行動應用程式中，不預期用戶在會話期間始終處於在線狀態。與傳統Web連接相比，行動網際網路連接的可靠性或可預測性要低得多。因此，行動應用程式可能對需要離線驗證的上線時間有要求。這種離線要求可能會對開發人員在實施行動身份驗證時必須考慮的事項產生深遠的影響。

為了檢測不佳的身份驗證架構，測試人員可以在行動應用程式處於“離線”模式時對其進行二進制攻擊。通過這種攻擊，測試人員將迫使應用程式規避離線驗證，然後執行應該需要離線驗證的功能（有關二進制攻擊的更多信息，請參見M10）。同樣，測試人員應嘗試刪除任何POST/GET請求的會話令牌，匿名執行任何後端伺服器功能。

為了測試不佳的授權架構，測試人員可以對行動應用程式進行二進制攻擊，嘗試在行動應用程式處於“離線”模式時執行僅應由更高特權用戶執行的特權功能（有關二進制攻擊的更多信息，請參見M10）。此外，測試人員應嘗試在後端伺服器敏感功能的相應 POST/GET 請求中使用低特權會話令牌來執行任何特權功能。差或有所缺失的授權架構允許攻擊者使用已通過身份驗證但特權較低的行動應用程式用戶執行不應被授權執行的功能。在行動裝置內而不是通過遠程伺服器進行授權決策時，授權要求更容易受到威脅。這可能是由於離線可用性的行動要求。

# 技術性影響	

**影響程度 嚴重**


不佳的身份驗證的技術影響在於程式無法識別執行動作請求的使用者。由於無法建立使用者的身份，程式將無法記錄或監控使用者活動。這將導致無法檢測攻擊的來源、潛在漏洞利用的性質，以及如何防止未來的攻擊。

身份驗證錯誤還可能暴露底層的授權錯誤。當身份驗證控制失敗時，程式無法驗證用戶的身份，而這與用戶的角色和其相關權限密切相關。如果攻擊者可以匿名執行敏感功能，這表明底層程式碼未驗證發出該請求的用戶的權限。因此，程式碼的匿名執行凸顯了身份驗證和授權控制的錯誤。

不佳的授權的技術影響在性質上類似於不佳的身份驗證的技術影響。技術影響在性質上有很大差異，取決於執行的超權功能的性質。例如，對遠程或本地管理功能的超權執行可能導致系統的破壞或對敏感信息的訪問。

# 業務影響
	
**應用程式/業務 特定** 
		

不佳的身份驗證的業務影響通常至少會導致以下結果：

- 聲譽損害

如果一個使用者（匿名或已驗證）能夠執行超權功能，業務可能會遭受以下影響：

- 聲譽損害;
- 詐騙;
- 信息盜竊。

# 我是否容易受到「不佳的身分驗證與授權」的攻擊？

避免以下不安全的行動應用程式身份驗證設計模式:

- 如果正在將 Web 應用程式移植到其行動版本，行動應用程式的身份驗證要求應與 Web 應用程式元件的相應部分相匹配。因此，不應該允許使用比 Web 瀏覽器更少的身份驗證因素進行身份驗證。
- 在本地對用戶進行身份驗證可能導致客戶端規避漏洞。如果應用程式在本地存儲數據，則可以通過運行時操縱或修改二進制文件來規避越獄裝置上的身份驗證例程。如果存在對離線身份驗證的迫切業務要求，請參見M10，以獲取有關防止針對行動應用程式的二進制攻擊的附加指南。
- 在可能的情況下，確保所有身份驗證請求都在伺服器端執行。在成功驗證後，應用程式數據將加載到行動裝置上。這將確保應用程式數據僅在成功驗證後方可使用。
- 如果需要在客戶端存儲數據，則需要使用從用戶登錄憑據安全派生的加密密鑰對數據進行加密。這將確保只有在成功輸入正確憑據後才能訪問存儲的應用程式數據。此外還存在通過二進制攻擊解密數據的額外風險。請參見M10，以獲取有關防止導致本地數據被盜的二進制攻擊的附加指南。
- 行動應用程式中實施的持久身份驗證（記住我）功能永遠不應將用戶的密碼存儲在裝置上。
- 理想情況下，行動應用程式應該使用可以由用戶在應用程式內，撤銷特定裝置身份驗證令牌。這將確保該應用程式可以防範從被盜/遺失的裝置進行的未授權訪問。
- 不要使用可以偽造的值來對用戶進行身份驗證。這包括裝置識別符或地理位置。
- 行動應用程式中的持久身份驗證應該作為選擇加以實施，而不應默認啟用。
- 如果可以，不要允許用戶為身份驗證密碼提供4位數的PIN號碼。


# 如何防止「不佳的身分驗證與授權」?

開發人員應該假設所有客戶端身份驗證和授權控制都可能被惡意用戶規避。在可能的情況下，應該強化伺服器端的授權和身份驗證控制。

由於離線使用的要求，行動應用程式可能需要在應用程式的程式碼中執行本地身份驗證或授權檢查。如果是這種情況，開發人員應該在程式碼中實施本地完整性檢查，以檢測任何未經授權的程式碼更改。有關檢測並應對二進制攻擊的更多信息，請參見M10。

# 攻擊情境舉例

以下情境展示了行動應用程式中不佳的身份驗證或授權控制:

1. 開發人員假設只有經過身份驗證的用戶才能生成由行動應用程式提交給後端進行處理的服務請求。在處理請求的過程中，伺服器程式碼未驗證傳入請求是否與已知用戶相關聯。因此，攻擊者可以向後端服務提交服務請求，匿名執行影響使用程式的合法用戶的功能。
2. 開發人員假設只有經授權的用戶才能在其行動應用程式中看到特定功能的存在。因此，他們預期只有經合法授權的用戶才能從其行動裝置發出對服務的請求。處理請求的後端程式碼不考慮驗證與請求相關聯的身份是否有權執行該服務。因此，攻擊者能夠使用相當低權限的用戶帳戶執行遠程管理功能。
3. 由於可用性要求，行動應用程式允許密碼長度為4位數。伺服器程式碼正確存儲密碼的雜湊版本。但由於密碼長度極短，攻擊者將能夠快速使用彩虹表推斷原始密碼。如果伺服器上的密碼文件（或數據存儲）被入侵，攻擊者將能夠快速推斷用戶的密碼。

# 參考資料

- OWASP
  - [OWASP Cryptographic Storage Cheat Sheet](https://www.owasp.org/index.php/Cryptographic_Storage_Cheat_Sheet)
  - [OWASP Key Management Cheat Sheet](https://www.owasp.org/index.php/Key_Management_Cheat_Sheet)
- External
  - [NIST Encryption Guidelines](http://csrc.nist.gov/publications/drafts/800-175/sp800-175b_draft.pdf)