---

layout: col-sidebar
title: "M3: 不安全的通信"
---

# 威脅主體

**應用層面 特定**

在設計行動應用程式時，數據通常以客戶端-伺服器的方式進行交換。當程式傳輸其數據時，它必須穿越行動裝置的載體網路和網際網路。威脅主體可能會利用敏感數據正在網路傳輸過程中時被截取的漏洞。有以下威脅主體存在:

- 共享您本地網絡的攻擊者（被駭或被監控的Wi-Fi）;
- 載體或網路設備（路由器、基站、代理等）; 
- 行動裝置上的惡意軟體。

# 攻擊媒介	

**利用難度 簡單**

監控網路進行不安全通信的可利用因子是廣泛的。在載體網路上監控流量比在本地咖啡店監控流量更難。一般來說，有針對性的攻擊更容易執行。

# 安全層面的強度

**普及性 常見** <br />
**偵測性 平均**

行動應用程式通常未對網路流量進行保護。它們可能在身份驗證期間使用SSL/TLS，但在其他地方卻不使用。這種不一致性會導致數據和會話ID面臨被攔截的風險。使用傳輸安全協定並不意味著應用程式已正確實行。要檢測基本缺陷，可以觀察手機的網路流量。更微妙的缺陷需要檢查應用程式的設計和配置。

# 技術性影響

**影響程度 嚴重**

這種缺陷會暴露個別用戶的數據，可能導致帳戶被盜。如果供給者攔截了管理員帳戶，整個網站可能會被暴露。不良的SSL設置還可能促使釣魚和中間人攻擊。

# 業務影響
	
**應用程式/業務 特定** 
		

最低程度，通過通信渠道截取敏感數據將導致隱私侵犯。

侵犯用戶保密性可能導致:

- 身分竊盜;
- 詐欺;
- 聲譽損害。

# 我是否容易受到「不安全的通信」的攻擊?

這個風險涵蓋了從A點到B點獲取數據的所有層面，但是是以不安全的方式進行。它包括行動裝置間的通信、應用程式到伺服器的通信，或行動裝置到其他東西的通信。這種風險包括行動裝置可能使用的所有通信技術：TCP/IP、WiFi、藍牙/藍牙低功耗（Bluetooth-LE）、NFC、音頻、紅外線、GSM、3G、短信等。

所有的TLS通信問題都歸在這裡。所有NFC、藍牙和WiFi的問題都歸在這裡。

顯著的特點包括將某種敏感數據封裝起來，並將其傳輸到裝置內或外。一些敏感數據的例子包括加密密鑰、密碼、私人用戶信息、帳戶詳細信息、會話令牌、文檔、詮釋資料和二進制文件。這些敏感數據可能是來自伺服器的，也可能是應用程式發送到伺服器的，或者可能在裝置和其他本地東西之間進行傳遞（例如，NFC終端或NFC卡）。這個風險的定義特點是存在兩個裝置，它們之間傳輸一些數據。

如果數據是在裝置本地存儲的，那就是 #不安全數據。如果會話詳細信息是安全地傳輸的（例如，通過強大的TLS連接），但會話標識本身不好（也許是可預測的、低混亂等），那就是一個 #不安全身份驗證 的問題，而不是一個通信問題。

不安全通信的一般風險涉及數據完整性、數據保密性和來源完整性。如果數據在傳輸過程中可以被更改，而這種更改無法被檢測到（例如，通過中間人攻擊），就是這種風險的一個很好的例子。如果機密數據可以通過觀察通信過程中的數據（即竊聽）或通過在通信進行中錄製對話並在之後進行攻擊（離線攻擊）來暴露、學習或推導，那也是一個不安全通信的問題。未能正確設置和驗證TLS連接（例如，憑證檢查、弱密碼、其他TLS配置問題）都包含在不安全通信中。

# 如何防止「不安全的通信」?

**一般情況的最佳做法**

* 假設網絡層不安全且容易被竊聽。
* 對行動應用程序用來將數據傳輸到後端API或Web服務的傳輸通道應用SSL/TLS。
* 在應用程序通過瀏覽器/Webkit運行例行程序時，考慮外部實體（如第三方分析公司、社交網絡等），使用它們的SSL版本。避免混合SSL會話，因為這可能會暴露用戶的會話ID。
* 使用強大的業界標準密碼套件，並使用適當的密鑰長度。
* 使用由可信的憑證管理中心(CA)提供者簽名的認證。
* 永遠不要允許不良的認證，並對於安全意識較高的應用程式，考慮固定的認證。
* 始終要求SSL鏈驗證。
* 只有在使用可信的密鑰鏈中的認證，來核實端點服務器的身份之後，才建立安全連接。
* 如果行動應用程序檢測到無效認證，通過UI向用戶發出警告。
* 不要通過替代通道（例如SMS、MMS或通知）發送敏感數據。
* 如果可能，在將敏感數據提供給SSL通道之前，對其應用單獨的加密層。如果將來在SSL實施中發現漏洞，加密數據將提供對保密性侵犯的第二防禦。

新的威脅使攻擊者能夠在行動裝置的SSL函式庫加密並將網路流量傳輸到目標伺服器之前，在行動裝置內部截取敏感流量。有關這種風險性質的更多信息，請參見M10

**針對IOS的最佳實踐**

在最新版本的iOS中，默認的類別非常好地處理SSL密碼強度協商。問題出現在開發人員臨時添加規避這些默認值以應對開發障礙的程式碼時。除了上述的一般實踐之外:

- 確保憑證是有效的，並在失敗時關閉。
- 在使用CFNetwork時，考慮使用Secure Transport API 來指定信任的客戶端認證。幾乎在所有情況下，應使用NSStreamSocketSecurityLevelTLSv1以獲得更高標準的密碼強度。
- 開發完成後，確保所有NSURL調用（或NSURL的封裝）不允許自簽名或無效的認證，例如NSURL的類方法setAllowsAnyHTTPSCertificate。
- 考慮使用憑證固定，具體做法如下：輸出您的憑證，將其包含在應用程式同捆包中，並將其錨定到您的信任對象。使用NSURL方法connection:willSendRequestForAuthenticationChallenge: 將會接受您的憑證。

**針對Android的最佳實踐**

- 在開發週期結束後，刪除所有可能使應用程式接受所有認證的程式碼，例如org.apache.http.conn.ssl.AllowAllHostnameVerifier或SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER。這相當於信任所有認證。
- 如果使用擴展SSLSocketFactory的類別，確保正確實現checkServerTrusted方法，以便正確檢查服務器認證。

# 攻擊情境舉例

侵入測試人員在檢查行動應用程式通信安全性時常常發現的一些常見情境包括:

**缺乏認證檢查**

行動應用程式和端點成功連接並執行 TLS 握手以建立安全通道。然而，行動應用程式未檢查伺服器提供的認證，並無條件地接受伺服器提供的任何認證。這摧毀了行動應用程式和端點之間的任何相互認證能力。行動應用程式容易受到透過 TLS 代理進行的中間人攻擊。

**脆弱的握手協商**

行動應用程式和端點成功連接並作為連接握手的一部分協商一個密碼套件。客戶端成功與伺服器協商使用弱密碼套件，導致弱加密，容易被攻擊者解密。這危及行動應用程式和端點之間通道的機密性。

**隱私資訊洩漏**

行動應用程式透過非安全通道而非 SSL 傳輸個人可辨識的資訊至端點。這危及行動應用程式和端點之間任何涉及隱私的資料的機密性。

# 參考資料

- OWASP
  - [OWASP](https://www.owasp.org/)
- External
  - [External References](http://cwe.mitre.org/)