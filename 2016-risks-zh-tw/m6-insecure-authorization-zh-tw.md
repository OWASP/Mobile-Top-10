---

layout: col-sidebar
title: "M6: 不安全的授權"
---

# 威脅主體

**應用層面 特定**

利用授權漏洞的威脅主體通常會透過使用現有或自行建構的工具進行自動化攻擊。

# 攻擊媒介	

**利用難度 簡單**

一旦攻擊者了解授權架構存在漏洞，他們將以合法用戶的身份登錄應用程式。他們成功通過身份驗證控制。一旦通過身份驗證，他們通常會強制瀏覽到一個易受攻擊的端點以執行管理功能。這個提交過程通常是透過裝置內的行動惡意軟體或攻擊者擁有的僵屍網路（botnets）完成的。

# 安全層面的強度	

**普及性 常見** <br />
**偵測性 平均**

為了測試不良的授權架構，測試人員可以對行動應用程式進行二進制攻擊，嘗試在行動應用程式處於“離線”模式時執行應該只能由更高特權的用戶執行的特權功能（有關二進制攻擊的更多信息，請參見 M9 和 M10）。此外，測試人員應試圖使用相應的POST/GET請求中的低特權會話令牌執行任何特權功能以向後端伺服器提交相應的敏感功能。不良或缺失的授權架構允許攻擊者使用經過身份驗證但權限較低的行動應用程式用戶執行他們不應有的功能。在行動裝置內進行授權決策，而不是通過遠程伺服器進行，會使授權要求更容易受到攻擊。這可能是由於離線可用性的行動需求所致。

# 技術性影響

**影響程度 嚴重**

不良授權的技術姓影響在本質上與不良身份驗證的技術性影響相似。技術性影響的範圍廣泛，並取決於過度授權功能的性質。例如，對遠程或本地管理功能的過度授權可能導致系統被破壞或被訪問敏感信息。

# 業務影響
	
**應用程式/業務 特定** 
		

在某個使用者（匿名或已驗證）能夠執行過度授權功能的情況下，業務可能會遭受以下影響：
- 名聲受損;
- 詐欺; 
- 信息被盜竊。

# 我是否容易受到「不安全的授權」的攻擊？

了解身份驗證和授權之間的區別是很重要的。身份驗證是用來識別個人。授權是檢查已識別的個人是否具有執行該行為所需的權限。這兩者密切相關，因為在來自行動裝置的請求身份驗證後，應立即進行授權檢查。

如果一個組織在執行來自行動裝置的API端點之前未對個人進行身份驗證，那麼程式碼自動會受到不安全授權的影響。當呼叫者的身份未確定時，本質上無法對請求進行授權檢查。

在試圖確定一個行動端點是否受到不安全授權，有一些簡單的規則要遵循：

- **存在不安全的直接物件參照（IDOR）漏洞** - 如果存在不安全的直接物件參照漏洞（IDOR），則程式碼很可能未執行有效的授權檢查;
- **隱藏的端點** - 通常，開發人員不會對後端隱藏的功能執行授權檢查，因為他們認為隱藏的功能只能被具有正確身分的人看到;
- **用戶角色或權限傳輸** -  如果行動應用程式將用戶的角色或權限作為請求的一部分傳輸到後端系統，則它受到不安全的授權的影響。

# 如何防止「不安全的授權」?

為了避免不安全的授權檢查，請執行以下操作:

- 使用僅包含在後端系統中的信息來驗證經身份驗證的用戶的角色和權限。避免依賴來自行動裝置本身的任何角色或權限信息;
- 後端程式碼應獨立驗證與請求相關的任何傳入標識符（請求運算的運算子）是否匹配並屬於傳入的身份;

# 攻擊情境舉例

**情境1:** 不安全的直接物件參照(IDOR):

用戶對後端REST API進行API端點請求，包括一個 actor ID 和一個 oAuth bearer 令牌。用戶將其 actor ID 作為傳入URL的一部分，並包含將訪問令牌作為請求的標準標頭。後端驗證了bearer令牌的存在，但未驗證與bearer令牌相關聯的 actor ID。結果，用戶可以調整 actor ID，作為REST API請求的一部分獲取其他用戶的帳戶信息。

**情境2:** 傳輸LDAP角色:

用戶對後端REST API進行API端點請求，其中包括一個標準的oAuth bearer令牌，以及一個標頭，其中包含用戶所屬的LDAP組列表。後端請求驗證了bearer令牌，然後檢查傳入的LDAP組是否具有正確的群組成員資格，然後繼續進行敏感功能。但是，後端系統未對LDAP群組成員資格進行獨立驗證，而是依賴於來自用戶的傳入LDAP信息。用戶可以調整傳入的標頭，報告自己是任何LDAP組的成員，並執行管理功能。

# 參考資料

- OWASP
  - [OWASP](https://www.owasp.org/)
- External
  - [External References](http://cwe.mitre.org/)